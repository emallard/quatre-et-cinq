<html>

<head>
    <title>4et5 - raycast debug</title>

    <script src="libs/jquery.3.1.1.min.js"></script>
    <script src="libs/three.js"></script>
    <script src="libs/gl-matrix.js"></script>
    <script src="libs/knockout-3.4.1.js"></script>
    <script src="app/built/built.js"></script>

</head>

<body>
    <!--
    <input id='pickX'><input id='pickY'>
    <button id='pickButton'>Pick</button>
    <br/>
    <button id='renderLoopButton'>renderLoop</button>
    <br/>
-->
	<div id='root' style=display:inline-block>
        
    </div>

    <div class='debug' style='background-color:white'>
    </div>

    <script>
        
        qec.resources.loadAll(onResourceLoaded);
        
        function onResourceLoaded()
        {
            var sceneName = getParameterByName('scene');
            var json = getParameterByName('json');
            if (sceneName == undefined && json == undefined)
                alert("scene?sceneName - json?json");

            if (sceneName != undefined)
            {
                var r = new qec.devRenderer();
                r.sceneName = 'data/' + sceneName;
                r.isParallel = getParameterByName('isParallel') == '1';
                r.isHardware = getParameterByName('isHardware') == '1';
                r.isBoth = getParameterByName('isBoth') == '1';
                r.isAnimate = getParameterByName('isAnimate') == '1';
                r.isFullScreen = getParameterByName('isFullScreen') == '1';
                r.renderSteps = getParameterByName('renderSteps') == '1';
                r.start(document.getElementById('root'));
            }
            else
            {
                var req = new XMLHttpRequest();
                req.open('GET', 'data/'+json, true);
                req.onreadystatechange = () => {
                    if (req.readyState == 4) {
                        if (req.status == 200) {
                            let downloadedJson = JSON.parse(req.responseText);
                            console.log(downloadedJson);
                            for (let a of downloadedJson.array)
                            {
                                let settings = new qec.devRendererSettings();
                                for (let key in a)
                                {
                                    settings[key] = a[key];
                                }
                                var r = new qec.devRenderer();
                                r.setSettings(settings);
                                r.start(document.getElementById('root'));
                            }
                        }
                        else {
                            console.error("Erreur pendant le chargement du json.\n");
                        }
                    }
                };
                req.send(null);
            }
        }

            /*
            var pickClicked = false;    
            var pickbutton = document.getElementById('pickButton');
            var renderLoopButton = document.getElementById('renderLoopButton');
            var root = document.getElementById('root');
            
            pickbutton.addEventListener("click", function(e)
            {
                pickClicked = true;
            });
            root.addEventListener("mousemove", function(e)
            {
                if (pickClicked) {
                    document.getElementById('pickX').value = e.offsetX;
                    document.getElementById('pickY').value = e.offsetY;
                }
            });
            root.addEventListener("mousedown", function(e)
            {
                if (pickClicked)
                {
                    pickClicked = false;
                    if (p2.debug)
                    {
                        var x = document.getElementById('pickX').value;
                        var y = document.getElementById('pickY').value;
                        p2.debug(parseFloat(x), parseFloat(y))
                    }
                }
            });

            renderLoopButton.addEventListener("click", function(e)
            {
                p2.startRenderLoop();
            });
            */

    </script>
</body>

</html>
